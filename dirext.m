function [pathstruct,pathstr]=dirext(thepath,syntax)
% ???????????????????
% ????dos?????????
% [~,pathstruct]=system(['dir /B/S ', thepath])
%
% ????
% thepath????????
% syntax?????????????
% ???? http://www.cnblogs.com/deerchao/archive/2006/08/24/zhengzhe30fengzhongjiaocheng.html
% .                    ?????????????
% \w            ??????????????
% \s                    ????????
% \d                    ????
% \b                    ??????????
% ^                    ????????
% $                    ????????
% *                    ????????
% +                    ????????
% ?                    ???????
% {n}                    ??n?
% {n,}                    ??n?????
% {n,m}                    ??n?m?
%
% ????
% pathstruct: ?????????????????dir??
% pathstr: ??????????
% 
% ????
% thepath='C:\Users\dynamic\Documents';;
% syntax='wav' % ????wav??
% [pathstruct,pathstr]=dirext(thepath,syntax)
%
persistent list count
if isempty(list)
    count=0;
    list=struct('name',[],'date',[],'bytes',[],'isdir',[],'datenum',[],'path',[]);%{thepath};
else
    tmp=length(list);
    if count>0.8*tmp;
        list(2*tmp)=list(1);
    end
end

filesystem=dir(thepath);
for i=1:length(filesystem)
    file=filesystem(i);
    name=file.name;
    type=file.isdir;    
    if ~strcmpi(name,'.') && ~strcmpi(name,'..')
        count=count+1;
        nextpath=fullfile(thepath,name);
        file.path=nextpath;
        list(count)=file;
        if type
            dirext(nextpath);
        end
    end
end
pathstruct=list(1:count);
if nargin==2
    listpath={pathstruct.path};
    flag=regexp(listpath,syntax);
    pathstruct=pathstruct(~cellfun(@isempty,flag));
end
pathstr={pathstruct.path}';